<!--
  MTurk UI that takes .csv with youtube id, start time, end time, and labels
  and displays said video (should be 1sec) to the user repeatedly
  
  Justin Goodman
  Marc Moore
  -->
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
<meta content="width=device-width,initial-scale=1" name="viewport" />
<script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<!-- Instructions -->
<section class="container">
  <div class="row justify-content-center">
    <div class="panel-body" id="instructionBody">
      <h1>Instructions:</h1>
      <p>We will be showing you a 10 second clip from a YouTube video. Look at the label provided for the video, and determine whether the video is <b>good</b> or <b>bad</b> based on the criteria following this paragraph. Please have the sound enabled on your machine and be ready to listen to the clip. You should click 'Play Video' when you are ready to play the clip. The clip will then auto-play on repeat until you click 'Pause Clip'. <b>Controls in the YouTube player are disabled</b>. We disabled the controls so we can show you one specific part of the video.</p>
      <ol>
        <li><b>Does the label match the event/object in the video?</b> If the label is 'tool', can you clearly see a tool somewhere in the clip? It does not have to present for the whole clip, we just want to know if it appears.</li>
        <li><b>Is the object in question the main focus of the clip?</b> It does not have to be present for the entire video, but it must be prominently displayed in the video when it is present.</li>
        <li><b>Does the sound you hear in the video match the label?</b> If the label is 'water' can you clearly hear running water?</li>
        <li><b>Is it clear that the object is the source of the sound?</b> If the label is 'speech', is the person you see in the clip the person that is speaking?</li>
      </ol>
      <p>If the video has all of these qualities, please mark <b>GOOD</b>. If the video is missing one or more of these qualities, please mark <b>BAD</b>.</p>
    </div>
  </div>
  <!-- End Instructions -->
  <hr />
  <!-- Video matching layout -->
  <div class="row" id="workContent">
    <div class="col-sm">
      <iframe id="player" width="640" height="360" src="https://www.youtube.com/embed/${ytid}?enablejsapi=1&amp;start=${start}&amp;end=${end}"></iframe>
      <!-- why are you looking here, get out! -->
      <input name="identifier" type="hidden" value="temporal" />
      <input name="ytid" type="hidden" value="${ytid}" />
      <input name="qa" type="hidden" value="0" id="dummy" />
    </div>
    <!-- Worker input -->
    <div class="col-sm">  
      <h4>Label for this video: <b>${labels}</b></h4>
      <button class="btn btn-primary" onclick="play(this);" type="button" style="">Play Video</button>
      <div class="form-group">
        <br />
        <h5>Is the video good or bad according to our criteria?</h5>
        <div class="form-check">
          <label class="form-check-label">
            <input class="form-check-input" type="radio" name="response" value="0" />
            BAD
          </label>
        </div>
        <div class="form-check">
          <label class="form-check-label">
            <input class="form-check-input" type="radio" name="response" value="1" />
            GOOD
          </label>
        </div>
      </div>
      <input type="submit" id="submitButton" class="submit btn btn-primary" value="Submit Answer" />
    </div>
  </div>
</section>
<!-- End Video matching layout -->

<!-- Open internal style sheet -->
<style type="text/css">
  #submitButton {
  white-space: normal;
  }
  /* CSS for breaking long words/urls */
  .dont-break-out {
  overflow-wrap: break-word;
  word-wrap: break-word;
  -ms-word-break: break-all;
  word-break: break-all;
  word-break: break-word;
  -ms-hyphens: auto;
  -moz-hyphens: auto;
  -webkit-hyphens: auto;
  hyphens: auto;
  }
</style>
<!-- REU-2018 style code -->
<style>
</style>
<!-- End REU-2018 style code -->
<!-- End internal style sheet -->
<!-- External JS references -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<!-- REU-2018 script code -->
<script>
  // load youtube api
  var tag = document.createElement('script');
  tag.id = 'yt-api';
  tag.src = 'https://www.youtube.com/iframe_api';
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // create the video
  var player;
  window.onYouTubeIframeAPIReady = function() {
    player = new YT.Player('player', {events: {'onReady': ready, 'onStateChange': change}} );
  }

  // control functions
  function ready(event) {
    player.getIframe().setAttribute("style", "pointer-events: none;");
    if (player.isMuted()) {
      player.unMute();
    }
  }
  function change(event) {
    if (event.data == YT.PlayerState.ENDED) {
      player.loadVideoById({'videoId': '${ytid}','startSeconds': ${start},'endSeconds': ${end},'suggestedQuality': 'large'});
    }
  }
  var first = true;
  function play(ele) {
    player.playVideo();
    if (first) {
      first = false;
      document.getElementById("dummy").setAttribute("value", "1");
    }
    ele.setAttribute("onclick", "pause(this);");
    ele.textContent = "Pause Video";
  }
  function pause(ele) {
    player.pauseVideo();
    ele.setAttribute("onclick", "play(this);");
    ele.textContent = "Play Video";
    clearTimeout(timer);
  }
</script>
<!-- End REU script -->
