<!--
  MTurk UI that takes .csv with youtube id, start time, end time, and labels
  and displays a blurred video and asks users to describe the auditory scene
  
  Justin Goodman
  Marc Moore
  -->
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
<meta content="width=device-width,initial-scale=1" name="viewport" />
<script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<!-- Instructions -->
<section class="container">
  <div class="row">
    <div class="col-sm">
      <div class="accordian">
        <div class="card">
          <div class="card-header" role="tab" id="headingOne">
            <h5 class="mb-0">
              <a data-toggle="collapse" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne"><b>Instructions</b> (Please read if this is your first time) (Click to expand)</a>
            </h5>
          </div>
          <div id="collapseOne" class="collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
            <div class="card-body" id="instructionBody">
              <p>We will be showing you a short 10-30 second clip of a blurred video. We would like you to describe <em>with as much detail as possible</em> what is going on in the video <b>based on the sound</b>. Use the blurred video merely as a context; our sole focus is the <b>audio</b>. Please write <b>5 or more sentences</b> describing what is happening in the video. Avoid using phrases like, 'i think' or 'it seems like'. Please write your sentences as one whole paragraph (do not press enter after every sentence, separate them by periods). Please have the sound enabled on your machine and be ready to listen to the clip. You should click <span><button class="btn btn-primary" onclick="" type="button">Play Video</button></span> when you are ready to play the clip. The clip will then auto-play on repeat until you click <span><button class="btn btn-primary" onclick="" type="button">Pause Video</button></span>. <b>Controls in the YouTube player are disabled</b>. We disabled the controls so we can show you one specific part of the video.</p>
              <ul>
                <li><b>Be as descriptive as possible</b>. You are allowed to add creativity and infer what might be going on visually, but base all of your descriptions on the <b>audio scene</b>.</li>
                <li>Pay attention to details in the sound. Here is a list of some things to think about. Do not limit yourself to this list; it may or may not apply to your video -
                  <ul>
                    <li>Where do you think this is taking place?</li>
                    <li>Do you hear any people or animals? How many? What do you think they're doing?</li>
                    <li>If you hear music, consider the instruments or the genre.</li>
                    <li>If you hear speech, think about the age or gender of the speaker, where they might be, and why they're speaking.</li>
                  </ul>
                </li>
                <li>Example: In the blurred frame you see a lot of green and some dark blobs. In the audio scene you hear a ball being kicked and then a loud cheer from what sounds like thousands of people. Two sample sentences you might write are -
                  <ul>
                    <li>two teams play a game in a large green field.</li>
                    <li>a goal is scored and the crowd in the stadium cheers.</li>
                  </ul>
                </li>
              </ul>
              <p><b>NOTE: IF YOU SEE THE VIDEO WITHOUT A BLUR, THE VIDEO IS UNAVAILABLE, AND/OR YOU EXPERIENCE ANY DISPLAY ERRORS, DO NOT ACCEPT THIS HIT!</b></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Instructions -->
  <hr />
  <!-- Video matching layout -->
  <div class="row" id="workContent">
    <div class="col-sm">
      <h3 id="ass">Assignment:</h3>
      <br />
      <br />
      <div class="blur">
        <iframe id="player" width="640" height="360" src="https://www.youtube.com/embed/${ytid}?enablejsapi=1&amp;start=${start}&amp;end=${end}" filter="url(#svgBlur)"></iframe>
      </div>
      <br>
      <!-- why are you looking here, get out! -->
      <input name="identifier" type="hidden" value="audio" />
      <input name="ytid" type="hidden" value="${ytid}" />
      <input name="qa" type="hidden" value="0" id="dummy" />
    </div>
    <!-- Worker input -->
    <div class="col-sm">
      <div class="form-group">
        <h5>Describe the Audio Scene:</h5>
        <textarea class="form-control" name="response" rows="6" cols="250" required></textarea>
      </div>
      <button class="btn btn-primary" onclick="play(this);" type="button">Play Video</button>
      <input type='submit' id='submitButton' class="submit btn btn-primary" value='Submit Answer' />
    </div>
  </div>
</section>
<!-- End Video matching layout -->
<svg version="1.1" xmlns="http://www.w3.org/2000/svg">
  <filter id="svgBlur">
    <feGaussianBlur stdDeviation="30" />
  </filter>
</svg>
<!-- Open internal style sheet -->
<style type="text/css">
  #submitButton {
  white-space: normal;
  }
  /* CSS for breaking long words/urls */
  .dont-break-out {
  overflow-wrap: break-word;
  word-wrap: break-word;
  -ms-word-break: break-all;
  word-break: break-all;
  word-break: break-word;
  -ms-hyphens: auto;
  -moz-hyphens: auto;
  -webkit-hyphens: auto;
  hyphens: auto;
  }
  
  .blur {
  filter: url(#svgBlur);
  -webkit-filter: blur(30px) opacity(0.80);
  filter: blur(30px) opacity(0.80);
  // This is for IE 4 and up
  filter: Blur(Strength=20);
  // This is for IE 5.5 and up
  filter: progid:DXImageTransform.Microsoft.blur(pixelradius=30);
  }
</style>
<!-- End internal style sheet -->
<!-- External JS references -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<!-- REU-2018 script code -->
<script>
  // load youtube api
  var tag = document.createElement('script');
  tag.id = 'yt-api';
  tag.src = 'https://www.youtube.com/iframe_api';
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // create the video
  var player;
  window.onYouTubeIframeAPIReady = function() {
  player = new YT.Player('player', {events: {'onReady': ready, 'onStateChange': change}} );
  }

  // control functions
  function ready(event) {
  player.getIframe().setAttribute("style", "pointer-events: none;");
  if (player.isMuted()) {
  player.unMute();
  }
  }
  function change(event) {
  if (event.data == YT.PlayerState.ENDED) {
  player.loadVideoById({'videoId': '${ytid}','startSeconds': ${start},'endSeconds': ${end},'suggestedQuality': 'large'});
  }
  }
  var first = true;
  function play(ele) {
  player.playVideo();
  if (first) {
  first = false;
  document.getElementById("dummy").setAttribute("value", "1");
  }
  ele.setAttribute("onclick", "pause(this);");
  ele.textContent = "Pause Video";
  }
  function pause(ele) {
  player.pauseVideo();
  ele.setAttribute("onclick", "play(this);");
  ele.textContent = "Play Video";
  }
</script>
<!-- End REU script -->
